/* yocto-atos - Yocto module to make payment with Atos - Wrapper for Sips Office Json Interface - V0.1.0 */
"use strict";function CreditCard(a,b){this.config=b||{},this.logger=a}var _=require("lodash"),logger=require("yocto-logger"),joi=require("joi"),Q=require("q"),api=require("../api")(logger);CreditCard.prototype.createAuthorization=function(a){var b=Q.defer(),c=joi.object().required().keys({amount:joi.number().integer().required().min(0),captureDay:joi.number().integer().optional().min(0)["default"](7),captureMode:joi.string().optional()["default"]("VALIDATION"),cardNumber:joi.number().integer().required(),cardExpiryDate:joi.string().required().empty(),cardCSCValue:joi.string().required().empty(),orderId:joi.string().optional().empty(),s10TransactionReference:joi.object().keys({s10TransactionId:joi.string().required().empty(),s10TransactionIdDate:joi.string().required().empty()}),fraudData:joi.object()}),d=c.validate(a);return d.error?(this.logger.error("[ YoctoAtos.CreditCard.createAuthorization.joi ] - an error occured schema is not conform, more details : "+d.error.toString()),b.reject(d.error.toString()),b.promise):(a=d.value,this.logger.debug("[ YoctoAtos.CreditCard.createAuthorization ] - a new request will be send to create authorization payment"),api.process(this.config,"checkout/cardOrder",a,"createAuthorization",!1).then(function(a){b.resolve(a)})["catch"](function(a){this.logger.error("[ YoctoAtos.CreditCard.createAuthorization.create ] - the payment was not authorized"),b.reject(a)}.bind(this)),b.promise)},CreditCard.prototype.capturePayment=function(a){var b=Q.defer(),c=joi.object().required().keys({operationAmount:joi.number().integer().required().min(0),s10TransactionReference:joi.object().keys({s10TransactionId:joi.string().required().empty(),s10TransactionIdDate:joi.string().required().empty()})}),d=c.validate(a);return d.error?(this.logger.error("[ YoctoAtos.CreditCard.capturePayment.joi ] - an error occured schema is not conform, more details : "+d.error.toString()),b.reject(d.error.toString()),b.promise):(a=d.value,this.logger.debug("[ YoctoAtos.CreditCard.capturePayment ] - a new request will be send to create authorization payment"),api.process(this.config,"cashManagement/validate",a,"capturePayment").then(function(a){b.resolve(a)})["catch"](function(a){this.logger.error("[ YoctoAtos.CreditCard.capturePayment ] - the payment was not authorized"),b.reject(a)}.bind(this)),b.promise)},CreditCard.prototype.cancelPayment=function(a){var b=Q.defer(),c=joi.object().required().keys({operationAmount:joi.number().integer().optional().min(0).max(0)["default"](0),s10TransactionReference:joi.object().keys({s10TransactionId:joi.string().required().empty(),s10TransactionIdDate:joi.string().required().empty()})}),d=c.validate(a);return d.error?(this.logger.error("[ YoctoAtos.CreditCard.cancelPayment.joi ] - an error occured schema is not conform, more details : "+d.error.toString()),b.reject(d.error.toString()),b.promise):(a=d.value,this.logger.debug("[ YoctoAtos.CreditCard.cancelPayment ] - a new request will be send to create authorization payment"),api.process(this.config,"cashManagement/cancel",a,"capturePayment").then(function(a){b.resolve(a)})["catch"](function(a){this.logger.error("[ YoctoAtos.CreditCard.cancelPayment ] - the payment was not authorized"),b.reject(a)}.bind(this)),b.promise)},module.exports=function(a,b){return(_.isUndefined(a)||_.isNull(a))&&(logger.warning("[ CreditCard.constructor ] - Invalid logger given. Use internal logger"),a=logger),new CreditCard(a,b)};