/* yocto-atos - Yocto module to make payment with Atos - Wrapper for Sips Office Json Interface - V0.1.0 */
"use strict";function ApiRequest(a){this.logger=a}var logger=require("yocto-logger"),_=require("lodash"),Q=require("q"),utils=require("yocto-utils"),request=require("request");ApiRequest.prototype.prepare=function(a,b){try{var c=require("../utils")(this.logger);return a.seal=c.calculSEAL(a,b),a}catch(d){return this.logger.error("[ YoctoAtos.ApiRequest.prepare ] - an error occured : "+d),!1}},ApiRequest.prototype.process=function(a,b,c,d,e){var f=Q.defer();e=_.isUndefined(e)?!0:e;var g=a.host+"/"+b;return c=this.prepare(_.merge(_.clone(a.config),c),a.secretKey),_.isObject(c)?(this.logger.debug(["[ YoctoAtos.ApiRequest.process ] - Processing a POST request to :",g,"with data : ",e?utils.obj.inspect(c):"data not allow to be displayed"].join(" ")),request({json:!0,method:"POST",uri:g,body:c},function(a,b,c){this.logger.debug(["[ YoctoAtos.ApiRequest.process ] -","Receiving response with data below :",utils.obj.inspect(c)].join(" ")),!a&&b&&_.has(b,"statusCode")&&200===b.statusCode?f.resolve(c):(a=a||[b.statusCode||"Cannot find request status message",b.statusMessage||"Cannot find request message"].join(" "),this.logger.error(["[ YoctoAtos.ApiRequest.process ] - Http request error :",a].join(" ")),f.reject(a))}.bind(this))):(this.logger.error(["[ YoctoAtos.ApiRequest.process ] - Cannot process request for",d,"method.","Cannot prepare data with given value :",utils.obj.inspect(_.values(arguments))].join(" ")),f.reject()),f.promise},module.exports=function(a){return(_.isUndefined(a)||_.isNull(a))&&(logger.warning(["[ YoctoAtos.ApiRequest.constructor ] -","Invalid logger given. Use internal logger"].join(" ")),a=logger),new ApiRequest(a)};